--source include/master-slave.inc

--connection slave

--source include/stop_slave.inc
RESET SLAVE ALL;

--echo # Does not work for CHANGE MASTER:
SET @old_default_master_connection= @@default_master_connection;
SET default_master_connection = 'm1';
--replace_result $MASTER_MYPORT MASTER_MYPORT
eval CHANGE MASTER TO MASTER_HOST='127.0.0.1', MASTER_PORT=$MASTER_MYPORT, MASTER_USER='root';
SET @@default_master_connection= @old_default_master_connection;

--echo #
--echo # The first field, Connection_name, should say 'm1'...
--echo #
--let $status_items= Connection_name
--source include/show_all_slaves_status.inc
#query_vertical SHOW ALL SLAVES STATUS;


RESET SLAVE ALL;

--replace_result $MASTER_MYPORT MASTER_MYPORT
eval CHANGE MASTER 'm1' TO MASTER_HOST='127.0.0.1', MASTER_PORT=$MASTER_MYPORT, MASTER_USER='root';
SET @old_default_master_connection= @@default_master_connection;
SET default_master_connection = 'm1';
START SLAVE;
SET @@default_master_connection= @old_default_master_connection;

set default_master_connection = 'm1';
stop slave;
--source include/wait_for_slave_to_stop.inc
reset slave all;
set default_master_connection = '';
--disconnect slave
--connection default
